# Introduction

This thesis presents a detailed study and development of an application focused on sports betting odds, with an emphasis on identifying, optimizing, and notifying users about hedging opportunities. Hedging in sports betting involves placing wagers on both outcomes of a binary betting option to ensure a profit, irrespective of the final result. Such opportunities are found when the odds are structured so that the total payout exceeds the sum wagered. These opportunities typically occur during live betting situations, where a bettor places a bet either before or during a game, and due to events during the game the odds change dramatically enough to allow the user to ensure profit by betting on the other option. Additionally, this thesis will also conduct a historical data analysis to determine the feasibility of this strategy, and when it makes sense for the bettor to hedge.

## Motivation

The impetus behind this research stems from two principal aims. The first is to create an application where a bettor can inform the application of a bet they made on another platform, and the application will be able to mathematically determine and notify the bettor if there is a hedging opportunity available, and inform them of what they would need to bet to maximize profit. The second aim is to contribute to the body of knowledge in sports betting by conducting a historical analysis of betting odds, focusing on the profitability of hedging your bets and when a bettor should do so. This part of the research aims to provide insights into the mechanics and strategic use of hedging bets. The overarching goal is to offer a tool that not only aids bettors in making more informed decisions but also helps in curbing the adverse effects of gambling, such as addiction and financial losses.

While this research focuses on the intricacies of efficient sports betting practices through trial and analysis, the goal of this research is not to maximize profit. For this reason, it would not be advised to use this application or research to inform high stakes gambling in search of large sums of profits. In fact, the target audience for this application and research is the casual gambler who would like some more information and tools to enhance their sports viewing and betting experience. The type of person that this app and research would be the most relevant to would be the person who maybe sits down and watches whatever games they find interesting on TV and bets on them, but would likely never bet more than $20 in a night unless there was some occasion. Research into enhancing the experience for this kind of bettor is sparse, and valuable since the majority of gamblers gamble this way.

This tool and research are necessary due to the rapidly growing size of the sports betting industry an the lack of research regarding betting strategies and tools that can be used to both increase profitability and decrease gambling addiction risk. Most of the research done thus far has been conducted in Europe which has completely different gambling laws and regulations as well as a very different sports culture than what is seen in America, so there must be more research done in the states to assess the impact and potentially positive strategies and tools that can make sport betting safer and more entertaining for United States residents. Though there are major differences, valuable insights can be taken from the research that has been done in Europe thus far. In Europe alone the gross gaming revenue of sports betting was 41.7 billion Euros in 2020, with 55% of all bets being placed during the course of a sporting event. [@MichelsOttingLangrock2023] Meanwhile, little research has been done to examine how users can maximize their odds during live betting scenarios, and the implications using a hedging strategy might have on profitability and the prevelance of problematic gambling habits.

## Current State of the Art

The landscape of sports betting research, particularly in the context of hedging strategies, is currently limited. Most of the available literature is focused on markets outside the United States, or it concentrates on predicting outcomes of sports events and identifying bets with favorable odds. This thesis distinguishes itself by not predicting outcomes or assessing odds fairness. Instead, it focuses on presenting users with profitable betting options based on current market conditions and data from the-odds-api. [@theoddsapi23] A significant aspect of this research is the historical analysis of sports betting odds, an area that has not been thoroughly explored in existing literature. This analysis extends beyond theoretical models, providing a practical examination of historical outcomes and trends in sports betting odds.

### Arbitrage

One distinction that needs to be clear is the terminology and phenomena that I am decribing throughout this research. There is a similar concept in the world of sports betting commonly referred to as arbitrage. However, this is not within the scope of the paper, nor commonly possible or legal in the United States. Arbitrage, as commonly defined is the concept of finding sportsbooks that have odds on the same event that vary enough that you can place bets on both side of the bet and profit instantaneously, due to the discrepancy in odds at one specific point in time. In Europe, this can also be done via secondary betting markets where a user can sell their position, however these markets are illegal in the United States. The concept of sports betting arbitrage for all intents and purposes can be compared to stock market arbitrage, a common investment strategy where an investor profits off of the price discrepancy between two different markets. 

Hedging a bet on the otherhand, is when you take advantage of odds that are changed by events in the game, by betting on both sides of a bet. The concept of arbitrage is what spurred my interest into investing the implications of hedge betting within U.S. markets, but it is not the focal point of this paper, nor is it possible in the U.S. the same way it is in Europe.

The concept using arbitrage to profit has been explored before. Researchers were able to secure a guarenteed 19.2% profit using an arbitrage strategy in 2012. [@egonetal2012arbitrage] Proving that artibrage is a very viable strategy. Which prompted my curiosity into whether similar results could be replicated using a bet hedging strategy. 

## Goals of the Project

The thesis is structured around two primary objectives. The first is a comprehensive historical analysis to ascertain the occurrence and profitability of hedging opportunities in comparison to traditional betting strategies. This involves a systematic examination of odds data from previous sporting events to identify the prevalence and profitability of hedging strategies when compared betting solely based on what you believe the outcome will be. The second objective is the development of an application that pulls in real time odds data in order to identify and notify users of hedging opportunities and how to take advantage of them.

The historical analysis portion of the thesis is critical. It not only contributes to the academic field by shedding light on hedging as a sports betting strategy and its effectiveness but also serves as a foundational element for the application. This analysis will explore questions such as the optimal timing for placing hedging bets and how often these opportunities occur and when they are a favorable option when compared to sticking with your bet. Furthermore, it will examine the financial implications of this strategy, providing a clear picture of it's potential profitability.

## Ethical Implications

This thesis acknowledges the significant ethical considerations inherent in sports betting. A primary concern is ensuring that the application and its recommendations do not inadvertently foster gambling addiction or encourage irresponsible betting practices. This involves a commitment to promoting responsible gambling, providing users with information that highlights safe betting habits and the potential risks associated with gambling. Compliance with legal and regulatory standards in sports betting is another crucial aspect of this research, ensuring that the project adheres to the ethical and legal frameworks governing the industry. By addressing these ethical issues, the thesis aims to make a positive contribution to the sports betting field, enhancing user experience while promoting responsible and ethical gambling practices.

These concerns are addressed by a few key strategies that aim to mitigate the risk of gambling addiction. First, the application does not allow the user to place bets using it, nor will it handle money of any kind. Also, the unique position and niche of this research should enable users to avoid or mitigate many of the traditional pitfalls of gambling. Research indicates that live betting is traditionally problematic for users, and much of the negative behavior is linked to the feeling of having input and options in real time, as well as the ability to chase your losses using the "cash out" button found on most modern sportsbooks, that allow you to settle your bets early for an amount tied to the probability of your bet winning. [@KillickAndGriffiths2020] My application takes some of this control out of your hand by taking attention away from the betting platform and the especially dangerous "cash out" button, and instead putting you in a place where you are given live accurate information on how and where you can profit. This should theoretically remove some of the emotional decision making that typically causes gamblers losses and feeds into problematic gambling tendencies.

There is another somewhat related ethical risk, which is this work and app being heavily limited by third-party risk, which can not be eliminated. Due to the lack of regulation around sports betting and the fact that the industry's progression is currently outpacing regulation it is hard to verify the accuracy of the odds data we are receiving. While conducting this research and testing my application I have manually verified the accuracy of the data I am receiving from *the-odds-api*, but this is in no way conclusive or comprehensive. Additionally, *the-odds-api* gives no information on how it is able to access all of the odds across different sportbooks, and makes no promises about the integrity or reliability of their data. [@theoddsapi23] This introduces a fundamental risk about the longevity and reliablility of the findings of this project and the long term maintainability of the application. However, throughout research and testing there have been no sings that the data is in any way inaccurate or compromised, but the risk still remains. Which means it must be acknowledged that this application can make no promises of 100 percent accuracy, and anyone who chooses to use the application should verify the accuracy of the data it provides **before** placing any wagers. Unfortunately, this is a problem inherent to the industry at this point in time. Even sportsbooks such as *DraftKings* will not offer any guarentees about the integrity of their own data and make sure to explicitly state as much in their terms of use. [@draftkings2023] This is a problem that cannot be avoided if any investigation into sportsbook odds data is conducted, thus my strategy of gathering and verifying data is as thorough as is possible at this point in time.

# Related work

Most of the research relevant to this topic has centered around the psychology of betting decisions and gambling addiction, attempts at algorithmically predicting outcomes, or inherent human biases that cloud sound betting decisions. My research works to learn from all of these works and add to sparsely available literature regarding sports betting. Through research it seems that the foundation for the vast majority of negative outcomes for casual bettors occur due to a lack of knowledge or understanding. Which is why my research focuses on providing bettors more information as to what their options are during a live betting situation and what actions will allow them to profit or protect themselves from losses the best.

## Lack of Research

There is a very clear void in the current academic landscape when in comes to betting in the U.S. A variety of useful topics have been explored in Europe, however many of these findings are irrelevant to U.S. bettors due to different laws and regulations. Specifically when it comes to hedging strategies, it was hard to find any reliable literature on the subject, especially within the context of U.S. betting laws. There is a variety of research into the pitfalls of gambling addiction when it comes to sports betting, and particularly how marketing and the advent of mobile sports betting has exacerbated problem gambling. [@KillickAndGriffiths2020] However, little research has been done into the efficacy of different betting strategies. As well as how third party tools could inform users and ward off some of the typical factors that enhance the addictive tendencies of sports betting.

This makes this work even more crucial, because while the negative impacts of sports betting have been explored it is equally as important to research how these negative aspects can be curbed. One thing that related works have made clear, is that bettors do not often make sound betting decisions and that these decisions can lead to losses on behalf of the bettor. [@MichelsOttingLangrock2023] This raises concern for my work because unlike arbitrage, hedging relies on the bettor initally making a bet that aligns with the future outcome which has been shown to be difficult. However, hedging provides an opportunity for users to capitalize on a sporting event taking a turn in their preferred direction by locking in profits before the event has a chance to turn the other way. This should provide more opportunity for the user to win. Additionally, by providing the user a tool to quickly be notified of these occurances, they will have opportunities for profit that are unavailable to those who look for opportunities manually or are unaware of hedging. There is also the fact that more information is always better, when it comes to making good betting decisions, so by providing users information on their options this will always be a net positive. Addditionally, due to the construction of the application users must take their attention away from the emotion fueling sportsbook apps in order to monitor hedging opportunities, which will cut down on many of the factors that fuel problem gambling that sportsbooks often try to spur.

## Lack of Knowledge 

The concept that many casual bettors can act against their own best interest due to a lack of knowledge has been explored before. Researches investigated the betting outcomes of a few particular bettors during the 2015-2016 English Premier League season, where Leicester FC had majorly outperformed expectations. They had started the season with 5000 to 1 odds to win the league, meaning a bettor could bet $1 to win $5000, and some people took this bet. As the season progressed and Leicester continued performing well, sportsbooks offered a cashout option on this bet allowing users to settle their bet for huge profits, but less than what they would receive if their bet wins. Of those interviewed, everyone who placed this bet took the cash out option which cost them a collective 8,173.47 that they would have earned had they hedged their bet instead of cashing out. The conclusion being, that users chose to take the cashout option because it is much easier to understand, and right there in their face on the betting app. [@NewallandCortis2019]

This case study shows how bettors can make decisions detrimental to themselves due to a lack of knowledge surround what their options are. A common argument against hedging, is that more capital is required in order to place the hedge bet. However the line of thought that this could be a limiting factor, or potentially harmful to the bettor is not supported by sound logic. Firstly, my research is focused on the casual gambler, who uses sports betting to enhance their sport entertainment experience. In this case, a bettor would typically not be betting more than they can afford to hedge in order to receive guarenteed profits. Even in the case where a bettor has placed a bet so large that they cannot afford to hedge, in many cases they could take out a loan in order to hedge, and still profit after paying the interest on the loan. Fundamentally, the resistance to hedging is often linked to a lack of knowledge about the strategy. Which is why my research aims to simplify and inform bettors about hedging, and take much of the mental load and math involved in calculating a successful hedge off of the bettors shoulders.

## Emotion Driven Betting

In order to successfully produce a tool and data that is beneficial to bettors, it is crucial to have an understanding of the casual bettors' betting habits and what underlying factors drive their decisions. This is a very complex question that cannot be answered within the scope of this thesis. However, there are themes and indicators that can be drawn from previous research that informs this work. Many of the pitfalls that casual sport bettors often fall into can be traced back fundamentally to them letting their emotions fuel their betting decisions rather than sound logic and math. This can lead to bettors making decisions against their own interest due to the heat of the moment exacerbated by the introduction and prevalence of live betting.

Studies have shown that during live betting scenarios bettors will typically over react to positive events that occur during the game and place additional bets accordingly typically leading to losses, which causes the odds to move accordingly. [@MichelsOttingLangrock2023] This shows that most bettors are not able to accurately estimate the effect that in game events have on bet probabilities. While this research does not investigate how this relates to hedging strategies, it sheds light on some interesting phenomena. Firstly, it shows that bettors in aggregate typically over react to the in game events. Next, the odds of said bet then move accordingly due to the wave of incoming bets. This would indicate that at this point there is a discrepancy between the actual probability of an outcome, and the odds currently being offered. Which in theory, could be taken advantage of by a bettor.

This particular occurance highlights a broader issue that bettors are often unable to correctly asses risk and reward, which hinders bettors' abilities to profit and make sound bets. While this is not eliminated by this work, the only way to decrease the prevalence of these circumstances is to provide bettors with more conclusive and comprehensive information about the consequences of their bets and the options available to them. Which is why this work provides bettors with another avenue to profit from their bets. While this tool does not provide comprehensive information, the use of this application will hopefully nudge users to be more thoughtful and informed in their bets, increasing overall performance.

## Connection

This research situates itself in a niche not often explored by broader literature. This position is the implications of hedging on betting profitability, and aims to explore how this strategy can be used and when. Due to the lack of related works, the scope of this thesis becomes inherently larger. In connection to the more specific goals, this thesis must also answer questions about its connection to problematic gambling habits, U.S. gambling laws and regulations, and data integrity among many more. The app and related historical odds data analysis together serve to address the questions surrounding the efficacy of hedging strategies as they pertain to sports betting while maintaining an ethical position.

Much of the previous literature around the topic of sports betting rightfully points out many of the negative effects that sports betting and gambling as a whole can have on people. However, not many attempts have been made to investigate strategies and tools that can mitigate the negative effects of sports betting, without abolishing it or handicapping the industry. Which allows this tool and research to fill that void by equipping both researchers and bettors with a tool and chest of information that allows them to make more informed, safe betting decisions. 

Sports betting in specific, deserves more attention and research because of the interesting position that it finds itself in amongst the broader category of gambling. Most forms of gambling such as blackjack, craps, slot machines, and lottery tickets are inherently net negative games, meaning that even when played perfectly, the gambler will always lose money in the long run or in other words can never "beat the house". Sports betting on the other hand provides the potential to beat the house, because the house has no control over the outcomes of sporting events. The advantage that sportsbooks have over bettors is simply knowledge and scale and they have been able to use this advantage to profit handsomely. [@MichelsOttingLangrock2023] While the scale aspect cannot be addressed by research, the knowledge gap can. By closing the knowledge gap the playing field between bettors and sportsbooks can be closed, minimizing losses on the end of bettors. To provide bettors with information about implications and options when placing bets is to minimize the risks and harmful effects of betting while making it a more enjoyable experience for the bettor which is what this research accomplishes.

# Method of approach

The approach of my research centers around the web application that facilitates the instant notification of opportunities to hedge your bet. The main technologies involved in the implementation of this app are Python and the-odds-api, with various supplemental technologies being used to facilitate the smooth development and functionality of the application. Here is an architectural diagram of my application:

To be implemented:
Poetry -> Python/Flask + the-odds-api -> SQL database for user data -> htmx front end -> Netlify hosting

As shown above, my project uses Poetry to facilitate the easy management and installation of dependencies with Python. The bulk of the implementation of the web app and hedge opportunity finding algorithm are written using Python and Flask. This is the stage where user data is stored, bets are stored, and hedging opportunities are calculated with notifications being sent to the user via text. Data that is captured by the app are then stored in an SQL database to allow the data to be retrieved by the app later. Then, all of the necessary POST and GET requests are handled via htmx. Finally, the app is hosted using Netlify's hosting service.

## Usage

To illustrate the purpose, use case and function of the app let's investigate a theoretical user Bob. Bob is someone who enjoys getting home from work, cooking a nice meal, and turning on the NBA games for the night so that he can keep up to date with his favorite league. While doing so Bob occasionally enjoys placing a few small wagers on the game whenever he really has a gut feeling about an upcoming game or his favorite teams or players are playing. The issue is Bob doesn't have the time to do in depth research before everygame and can't shake the feeling that he isn't making optimal decisions, but doesn't have the time or know how to spend time filling out spreadsheets and analyzing sports and betting data before placing his bets. So what does he do instead? He opens up his sportsbook app of choice, and plunges head first into the countless betting options and distracting graphics and promotions that plague all sportsbooks.

That's where the Hedgemaster comes in. Now, whenever Bob places a bet on his sportsbook of choice, he can simply go in to the Hedgemaster after and relay the information about the team, the odds, the hedge profit percentage threshold and the bet amount into the app and Hedgemaster handles the rest. Then, Bob can put his phone down, and enjoy the games distraction free, without the complexities of trying to navigate and monitor the sportsbooks during the game. Then if a hedging opportunity arises at Bob's desired profit level he will instantly receive a text telling him what team to bet on, how much to bet, what his total stake will be, and what his guarenteed profit will be. Finally, all Bob has to do if he wishes to capitalize is go back on the sportsbook, place the bet with the information provided on the app, and sit back and enjoy the game and his profits.

In this example both Bob's betting and viewership experience has been enhanced. First, Bob was able to place a well informed bet without having to worry about checking his phone every 2 minutes to see if the odds have changed. Then Bob was able to enjoy the game, without the distraction of stressing about whether or not there may be a better bet to place. Finally, Bob was able to rest assured knowing that if an opportunity to profit off of his bet presented itself that he would be able to instantly capilize on it without having his sportsbook open at all times.

## Ethical Implementation

As previously mentioned, there are clear ethical implications regarding my project and the possible worsening of problematic gambling habits. To combat these concerns, my application has been strategically designed to at the very least not perpetuate if not lessen the risk factors that lead to problem gambling. My application takes a multifaceted approach to reduce problem gambling. First and foremost, UI design plays a key role in limiting the addictiveness of online sports betting. Major sportsbooks's applications are designed to promote users to place bets and stay on the app. They accomplish this using flashy colors, quick and accessible gambling options, and menus that are difficult to navigate to locate the exit and withdrawl options. My design eliminates these pitfalls by being minimalistic, easy to navigate, bland, and information centric. 

![UI Demo](images/ui_demo.pdf)

This implementation focuses on bringing information to the forefront of the user's attention, without any distracting and possibly addictive design qualities. My having the logout button at the top of the page, it makes it very easy for users to exit out of the application whenever they wish to end their session. Then, in the center of the page, you have both the ability to search the current odds, as well as search for hedging opportunities which are the two main focuses of the app. Finally at the bottom of the page, users are able to see all of the bets that they have already placed, making it more difficult for them to ignore their past bets and excessively gamble. This list of bets also provides users with additional information in the form of concrete data on their past betting and spending habits allowing them to make better decisions moving forward. These features contrast that of a traditional betting site or a casino, where it is easy to get lost in flashy interfaces with no information other than what bets you can place and the always easy to find deposit button.

Information is the primary weapon a user can use to both stave off overly cumbersome losses as well as problematic gambling habits. Which is why I have chosen an information first design, where all elements of the implementation assist the user in getting helpful, comprehensive, and easy to access and understand information throughout their duration on the app. In the name of this, my application will also allow users to track their spending, as well as allow them to set limits and warnings for themselves if their spending exceeds certain thresholds over predetermined periods of time. It should once again be emphasized, that this application is in no way intended for a professional gambler. This application targets the casual gambler that wishes to enhance the enjoyment, outcome, and safety of their at home recreational sports betting experience. Which is why the app does not facilitate the placing of bets, make outcome predictions, or accept money in any way. Instead, the application focuses on showcasing odds, possibilities and hedgable situations allowing users to make their own informed betting decisions. In the process, users using this app will not be on their sportsbook of choice where they are enabled and encouraged to make poor decisions. [@MichelsOttingLangrock2023] 

## Accounts

One of the most crucial features of my implementation is the ability to create and access personalized user accounts. Aside from the fact that storing users' information is crucial to the functionality of my tool, user accounts enable the privacy of the highly sensitive betting data that this application needs to collect in order to function. All passwords are encrypted and secured in a private database, allowing for the safe and convenient access and storage of user accounts.

Additionally, the creation of user account also enables most of the key features of my application to function properly. For one, the accounts allow for personal betting and spending history to be stored so that users may track their bets and spending over time. Having all the bets stored per account enables the constant checking for hedge opportunities, while also cutting down on the amount of API requests that the application needs to make in order to effectively find hedging opportunities.

Accounts in my application are kept very simple, and don't require users sacrificing personal information in order to sign up and use the app effectively. The only information that users need to provide to create an account are a username, a password, and a phone number if they would like to receive text notifications. If users wish to take the extra step to ensure their privacy and omit their phone number, they are still able to use the app just as effectively, having their bets and spending logged and having hedging opportunities found. The only difference between a phone number and non-phone number user is that users that elect to offer their phone number will receive text notifications automatically when a hedging opportunity occurs even when they are not signed in or using the app, whereas those who don't will have to check for hedging opportunities manually within the app. This minimal process streamlines and eases the path to users quickly receiving benefitial betting data while simultaneously minimizing the app's complexity. 

All the while, accounts preserve the privacy of the user. First, by making sure users' betting data are not publicly available, which is very important due to the stigma surrounding gambling as well as the financial nature of the data. While also, not requiring any personally identifiable data in order to sign up, eliminating much of the risk that would typically be associated with a data breach if that were to occur.

## The API

The main driver of the functionality of my project is the-odds-api, an API which gives both real time and historical sports betting odds for over 70 sports and over 40 bookmakers. [@theoddsapi23] While relying upon this API as heavily as this application does poses plenty of third-party risk, there are few alternatives. No bookmakers that I could find have public facing APIs or scrapable interfaces. There are competitors that offer services similar to the-odds-api, however these services pose the same risk as the-odds-api which is untestable data accuracy. In my experience the-odds-api has proven to be the fastest, easiest to use, and reliable in all instances which I have manually tested it.

The only thing that is required to implement this API is an API key, which I was able to easily acquire via there website. From there, the only thing to do is to begin making API requests. The API accepts many parameters, but for the purposes of this project the important ones are as follows: `API_KEY`, `SPORT`, `REGION`, `MARKET`, and `ODDS_FORMAT`. Many of these are self-explanatory, but the key ones to understand are `SPORT` and `MARKET`. `SPORT` allows you to select the sport that you wish to get data about, whereas `MARKET` allows you to select what type of bets you would like to receive such as moneylines, over/unders, or player prop bets. This research focuses on the moneyline bets or `h2h` market. This is because other forms of bets may change during the course of a game such as over/under where the actual over/under line will shift thoughout a game making it very difficult to track and calculate hedges. Whereas a moneyline bet can never change in that way, instead the bookmakers will adjust the odds of the moneyline event to account for events that occur during the game, which is the exact phenomena that allows for hedging. The `SPORT` setting can be changed at will, because regardless of the sport, moneyline bets will still be present.

Part of the power of the-odds-api is the sheer amount of information that can be collected from a single API request, which is important to us because API requests are a finite resource on this service. A basketball moneyline request for example will return every single moneyline bet available in the NBA from everysingle bookmaker that the service tracks. This is a vast amount of data that can be used to find hedging opportunities for every user on the application all at once due to the bets being stored with the users. This allows the program to for example analyze and find hedging opportunities for every single basketball bet all users have made with a single API request. The limiting factor here is that there has to be a new API request for every sport that the app is tracking. 

This flexibility and features that the API provide allow this program to leverage this information to make real-time analyses on every users bets all at once, which powers the effectiveness of this app. My application is then able to parse this data to find what points of data are relevent to the user and the bets that are already being tracked. Then it takes that data and performs calculations to determine where an arbitrage opportunity is possible, and what the most efficient arbitrage opportunity is.

## Algorithms

There are two important functions that power the applications ability to find hedging opportunities `hedge_finder()` and `calc_arb()`. These are the functions that allow the program to take in bets from the web interface and use the data from the API request to give the user information about potential hedging opportunities. The back-end of the app has been written in Python with the Flask framework to enable easy development, data handling, and algorithm implementation.

First you have the `hedge_finder()` function that works like this:
```py
@app.route('/hedge-finder', methods=['POST', 'GET'])
def hedge_finder():
    bet_team = request.form['bet_team']
    bet_odds = float(request.form['bet_odds'])
    bet_amt = float(request.form['bet_amt'])
    opp_odds, opp_team = get_opposing_teams_odds(bet_team)
    api_odds = max(opp_odds) if opp_odds else 0

    new_bet = Bet(bet_team=bet_team, bet_odds=bet_odds, bet_amount=bet_amt, user_id=current_user.id)
    db.session.add(new_bet)
    db.session.commit()

    if check_arb(bet_team, bet_odds, api_odds) != False:
        html_output = calc_arb(bet_odds, api_odds, bet_amt, bet_team, opp_team)
    else:
        html_output = f"<p>There is no arbitrage opportunity</p>"
    return html_output

if __name__ == '__main__':
    with app.app_context():
        db.create_all()
    app.run(debug=True)
```
This function accepts both `POST` and `GET` requests, allowing it to both take data in from the web form, and return data to the web app about potential hedging opportunities. Within this function you will see it takes in all of the data from the web form about a users bet with `bet_team`, `bet_odds`, and `bet_amt` then uses that data to get the rest of the data it needs to make decisions about a hedge opportunity using the `get_opposing_teams_odds()` function. `get_opposing_teams_odds()` then uses the team name to find out who they are playing and what the other teams odds are on various bookmakers. It then finds the bookmaker with the most favorable odds to the user in order to try to get the user the most profit possible. Next, it stores all of this data about the bet in a database, tied to the user's user id so that if there is not a hedging opportunity available in the present moment it can try to find one later. Then, it uses the `check_arb()` function to see whether or not a hedging opportunity is available. If one is not available it simply relays that information to the user, however if one is it then runs the `calc_arb()` function to calculate the details of the hedging opportunity.

The `calc_arb()` function works like this:

```py
def calc_arb(bet_odds, api_odds, bet_amt, bet_team, opp_team):
    hedge_bet_amt = (bet_amt * bet_odds) / api_odds

    total_bet_amt = bet_amt + hedge_bet_amt

    profit_if_initial_bet_wins = bet_amt * bet_odds - total_bet_amt
    profit_if_hedge_bet_wins = hedge_bet_amt * api_odds - total_bet_amt

    guaranteed_profit = min(profit_if_initial_bet_wins, profit_if_hedge_bet_wins)

    profit_percentage = (guaranteed_profit / total_bet_amt) * 100

    html_output = "<h2>Hedging Calculation</h2>"
    html_output += f"<p>Bet on {opp_team}: ${hedge_bet_amt:.2f}</p>"
    html_output += f"<p>Total wager: ${total_bet_amt:.2f}</p>"
    html_output += f"<p>Guaranteed profit: ${guaranteed_profit:.2f}</p>"    
    html_output += f"<p>Profit percentage: {profit_percentage:.2f}%</p>"

    return html_output
```
Once it receives all of the data about a bet from `hedge_finder()` it then does the math regarding what a user needs to in order to capitilize on this particular hedging opportunity. First, it finds out how much money the user should bet on the other team, then it uses that amount to calculate what their total stake would be after the hedge bet. Next, it calculates what their expected profit will be from this hedge bet, and what percentage profit they will make versus their initial stake. Finally it relays this information back to the web app, completing the cycle of finding an hedge opportunity.

## Technologies

There are many moving parts to this project and complexities due to the difficult nature of the task at hand. Here will be a brief rundown on the technologies that have been used throughout the development of this project, including how they are useful, why they are necessary, and how they assist in completing the goal of the research project. The main technologies used in this project are: Python, Poetry, Flask, SQL, HTMX, and the-odds-api.

The programming language for the back-end implementation Python was chosen due to its flexibility, variety of features, and my personal familiarity with the language. Python is rich with packages and compatibilities that made it highly suitable for a project with as many moving parts as this one. It has allowed this project to connect to a database, integrate algorithms, hook up to the web via Flask, integrate authentification, and make API requests, all while being smooth to develop and easy to read. These factors made Python the obvious choice to power this app.

To assist in the management of the complexity and moving parts of this project I decided to use the Poetry package manager. This enables the program to run in a virtual environment where all the packages and dependencies can be easily installed, managed, and updated without worrying to much about device compatibility or dependency installation. Poetry is a widely available and utilized Python tool that enables apps to be much more robust as dependencies grow over time, and developers to spend less time worrying about dependency installation, setup and updates.

Flask is a Python framework that allows you to easily and flexibly convert your Python programs into a web app, which made it a very attractive option for this project. There are alternatives out there such as Django, however in my experience Flask is much more flexible, customizable, and well suited for building a project from scratch. Which was necessary for this use case due to the unique features that this project required.

This project needed a way to store data over long periods of time in a way that was secure, accessible and well-organized in order to properly function. This data retention was required in order to enable user profiles, the storage of bets, and the usage of that data to find hedging opportunities, which meant that it needed a database. So, SQL was decided to be the database of choice due to its ease of setup, ability to organize data effectively, and my personal familiarity with the technology.

Due to the need for the constant flow of data to and from the front and back ends of the application, there needed to be a way to easily and dymanically transfer data to from the web page in real time. For that purpose HTMX was chosen which is a JavaScript library that allows you to access AJAX, CSS Transitions, WebSockets, and Server Sent Events directly in HTML, making it easier to create modern, dynamic web applications. This was very useful because it allowed the program to accept `POST` and `GET` requests directly in the HTML. Which cut down on development time and code complexity greatly.

Last but not least, the-odds-api was absolutely crucial to the development of this application. In order to accomplish the research goals a way to aggregate huge amounts of sports odds data was desperately needed. After searching every sportsbook and discovering that none of them had public facing APIs it was a huge relief to find the-odds-api which fulfilled all of our needs. It covers a huge amount of data with each API request, covers almost every sport, bet, and bookmaker in existence giving us a wide range of data to work with. Additionally, it updates odds every 40 seconds giving us frequent, accurate and up to date data, which is crucial for allowing our users to capitalize on quickly waning hedging opportunities. Finally, it also provides historical data, which was crucial for our experiments where we explored how often these arbitrage opportunities occur and how profitible they are versus a more traditional betting strategy. Add that to the fact that it is a very well documented API that was incredibly easy to implement into our Python program, and it was a very easy choice. While there are competitors attempting to provide a similar service none come close to the amount nor quality of features that the-odds-api offers.

# Experiments


## Experimental Design


## Evaluation

## Threats to Validity

# Conclusion

## Summary of Results

## Future Work

## Future Ethical Implications and Recommendations

## Conclusions


# References

::: {#refs}
:::
